<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Tasks ¬∑ Gantt timeline</title>
    <!-- SheetJS, html2canvas, jspdf (CDN) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #f1f5f9;
            display: flex;
            justify-content: center;
            padding: 2rem 1rem;
            margin: 0;
        }
        /* main card */
        .card {
            max-width: calc(100vw - 2rem);
            width: fit-content;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 35px -8px rgba(0,0,0,0.15), 0 5px 10px -4px rgba(0,0,0,0.05);
            padding: 1.5rem 1rem 1.5rem 1rem;
        }
        h1 {
            font-size: 1.8rem;
            font-weight: 500;
            margin: 0 0 1rem 0.5rem;
            letter-spacing: -0.01em;
            color: #0b1c33;
        }
        .toolbar {
            display: flex;
            gap: 12px;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            padding-left: 8px;
        }
        .btn {
            background: white;
            border: 1px solid #cbd5e1;
            padding: 0.4rem 1.2rem;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #1e293b;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.03);
            transition: 0.1s ease;
        }
        .btn:hover {
            background: #f8fafc;
            border-color: #94a3b8;
        }
        .btn.primary {
            background: #1e3a5f;
            border-color: #0f2b44;
            color: white;
        }
        .table-wrapper {
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            overflow: auto;
            max-height: 70vh;
            background: white;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.02);
        }
        table {
            border-collapse: collapse;
            table-layout: auto;
            font-size: 0.85rem;
            min-width: max-content;
        }
        /* sticky first two columns */
        th:first-child, td:first-child {
            position: sticky;
            left: 0;
            background: white;
            z-index: 10;
            border-right: 2px solid #cbd5e1;
            box-shadow: 2px 0 5px -2px rgba(0,0,0,0.05);
        }
        th:nth-child(2), td:nth-child(2) {
            position: sticky;
            left: 70px;          /* after first column 70px */
            background: white;
            z-index: 10;
            border-right: 2px solid #cbd5e1;
        }
        /* header background */
        th {
            background: #f8fafc !important;
            font-weight: 600;
            color: #1e293b;
            border-bottom: 2px solid #cbd5e1;
            white-space: nowrap;
            padding: 0 6px;
            height: 36px;
            vertical-align: middle;
        }
        td {
            height: 24px;
            padding: 0 4px;
            border-bottom: 1px solid #e9eef2;
            border-right: 1px solid #e9eef2;
            vertical-align: middle;
            white-space: nowrap;
        }
        /* column widths - updated */
        col.item-col { width: 70px; }
        col.task-col { width: 700px; }        /* increased from 600 to 700 */
        col.remark-col { width: 600px; }       /* unchanged */
        col.sfdc-col { width: 140px; }
        col.assigned-col { width: 140px; }
        col.start-col { width: 208px; }
        col.due-col { width: 208px; }
        col.dur-col { width: 208px; }
        col.progress-col { width: 400px; }
        col.status-col { width: 130px; }
        /* week columns - 15% larger = 28.75px ‚âà 29px, set to 29px */
        .week-cell {
            width: 29px;
            min-width: 29px;
            max-width: 29px;
            text-align: center;
            vertical-align: middle;
            padding: 0;
            font-size: 0.68rem;    /* 20% smaller than base 0.85rem ‚Üí 0.68rem */
        }
        /* cell scroll behaviour */
        .scrollable-cell {
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            scrollbar-width: thin;
            max-width: 100%;
            height: 24px;
            line-height: 24px;
            display: inline-block;
            width: 100%;
        }
        .scrollable-cell::-webkit-scrollbar {
            height: 3px;
            background: transparent;
        }
        .scrollable-cell::-webkit-scrollbar-thumb {
            background: #b9c7da;
            border-radius: 8px;
        }
        /* special for task/remark/assigned/sfdc */
        td .cell-content {
            display: flex;
            align-items: center;
            height: 24px;
        }
        /* progress bar cell - bar length 55% smaller (original 300px ‚Üí 135px) */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 6px;
            height: 24px;
        }
        .progress-bar-bg {
            width: 135px;           /* 55% smaller than 300px */
            background: #e9eef2;
            border-radius: 20px;
            height: 16px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #86efac, #15803d);
            border-radius: 20px;
            width: 0%;
        }
        .progress-percent {
            min-width: 45px;
            font-weight: 600;
            color: #0b3b2a;
            font-size: 0.8rem;
        }
        /* status chip */
        .status-chip {
            display: inline-block;
            height: 18px;
            line-height: 18px;
            padding: 0 10px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-align: center;
            background-color: #94a3b8;
            max-width: 110px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* week circle */
        .gantt-circle {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: currentColor;
            vertical-align: middle;
            margin: 0 auto;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        td.week-cell {
            text-align: center;
            vertical-align: middle;
            padding: 0;
        }
        /* item cell with icons - 30% smaller font & shape */
        .item-icons {
            display: flex;
            gap: 4px;
            align-items: center;
            height: 24px;
            font-weight: 500;
            font-size: 0.7rem;        /* 30% smaller than typical 1rem */
        }
        .item-icons span {
            cursor: pointer;
            font-size: 0.9rem;        /* icon size reduced (30% smaller from 1.3rem approx) */
            line-height: 1;
            user-select: none;
            color: #475569;
            transform: scale(0.85);    /* further shrink icons consistently */
        }
        .item-icons span:hover { color: #0f172a; }
        /* month headers - each in own cell, separated by subtle border */
        .month-header-cell {
            background: #d9eaf7;
            font-weight: 600;
            color: #1e3a5f;
            border-right: 2px solid #a0c0da;   /* stronger separation */
            border-bottom: 2px solid #b9d5ec;
            text-align: center;
            padding: 0 2px;
            white-space: nowrap;
        }
        /* month header row: each month gets its own th */
        .month-header-row th {
            background: #f0f4fa;
        }
        /* week header row cells */
        .week-number-cell {
            font-size: 0.68rem;
            font-weight: 500;
            background: #f8fafc;
            border-right: 1px solid #cbd5e1;
        }
        /* modal unchanged */
        .modal-overlay {
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(15,23,42,0.4);
            backdrop-filter: blur(2px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-card {
            background: white;
            border-radius: 32px;
            padding: 2rem 2rem 1.8rem;
            width: 500px;
            max-width: 94%;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }
        .modal-card h3 { font-size: 1.8rem; font-weight: 400; margin-top: 0; margin-bottom: 1.5rem; color:#0b2542; }
        .form-row { margin-bottom: 1rem; display: flex; flex-direction: column; }
        .form-row label { font-weight: 600; font-size: 0.9rem; margin-bottom: 0.2rem; color:#334155; }
        .form-row input, .form-row select, .form-row textarea {
            padding: 0.5rem 0.8rem;
            border: 1px solid #cbd5e1;
            border-radius: 20px;
            font-size: 0.95rem;
            background: white;
        }
        .form-row textarea { min-height: 70px; resize: vertical; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 0.8rem; margin-top: 2rem; }
        .hidden { display: none; }
    </style>
</head>
<body>
<div class="card" id="appCard">
    <h1>üìã My Tasks</h1>   <!-- changed title -->
    <div class="toolbar">
        <button class="btn primary" id="addTaskBtn">‚ûï New task</button>
        <button class="btn" id="importBtn">üì§ Import (Excel/CSV)</button>
        <button class="btn" id="exportExcelBtn">üì• Export Excel</button>
        <button class="btn" id="exportPdfBtn">üñ®Ô∏è Export PDF</button>
    </div>
    <div class="table-wrapper" id="tableWrapper">
        <table id="ganttTable">
            <thead id="tableHeader"></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<!-- MODAL for add/edit -->
<div id="modalOverlay" class="modal-overlay hidden">
    <div class="modal-card">
        <h3 id="modalTitle">‚ûï Edit task</h3>
        <div class="form-row">
            <label>Task</label>
            <input type="text" id="editTask" placeholder="Task description">
        </div>
        <div class="form-row">
            <label>SFDC link</label>
            <input type="text" id="editSfdc" placeholder="https://...">
        </div>
        <div class="form-row">
            <label>Remark</label>
            <textarea id="editRemark" placeholder="Notes..."></textarea>
        </div>
        <div class="form-row">
            <label>Assigned</label>
            <input type="text" id="editAssigned" placeholder="Person name">
        </div>
        <div class="form-row">
            <label>Start date</label>
            <input type="date" id="editStart">
        </div>
        <div class="form-row">
            <label>Due date</label>
            <input type="date" id="editDue">
        </div>
        <div class="form-row">
            <label>Progress %</label>
            <input type="number" id="editProgress" min="0" max="100" value="0">
        </div>
        <div class="form-row">
            <label>Status</label>
            <select id="editStatus">
                <option value="Not Started">Not Started</option>
                <option value="In Progress">In Progress</option>
                <option value="At Risk">At Risk</option>
                <option value="Blocked">Blocked</option>
                <option value="Done">Done</option>
            </select>
        </div>
        <div class="modal-actions">
            <button class="btn" id="modalCancel">Cancel</button>
            <button class="btn primary" id="modalSave">Save</button>
        </div>
    </div>
</div>

<script>
(function() {
    // ---------- status color map ----------
    const STATUS_COLOR = {
        'Not Started': '#94a3b8',
        'In Progress': '#2563eb',
        'At Risk': '#dc2626',
        'Blocked': '#ea580c',
        'Done': '#16a34a'
    };
    // pastel month colors array
    const MONTH_PASTEL = ['#f8d7e3','#d9eaf7','#e2f0da','#fff2cc','#d7d9f7','#f0dbcd','#c9e4f0','#f3d9f1','#d1e6d9','#ffe5b9','#d4e2f0','#f9d7d0'];

    // ---------- data model ----------
    let tasks = [];
    const STORAGE_KEY = 'gantt_tasks';

    // load from localStorage
    function loadTasks() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
            try { tasks = JSON.parse(stored); } catch { tasks = []; }
        } else {
            // demo default tasks
            tasks = [
                { id: 't1', task: 'Design database', sfdc: 'https://sfdc.com/001', remark: 'ERD', assigned: 'Alice', start: '2025-03-10', due: '2025-04-05', progress: 70, status: 'In Progress' },
                { id: 't2', task: 'Frontend prototype', sfdc: '', remark: 'Figma', assigned: 'Bob', start: '2025-03-20', due: '2025-04-10', progress: 40, status: 'At Risk' },
                { id: 't3', task: 'API integration', sfdc: '', remark: 'REST', assigned: 'Charlie', start: '2025-04-01', due: '2025-04-22', progress: 15, status: 'Not Started' },
            ];
        }
        tasks.forEach(t => { if (!t.id) t.id = crypto.randomUUID?.() || 'id-'+Date.now()+Math.random(); });
    }
    function saveTasks() { localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

    // ---------- helper: week numbers & month headers ----------
    function getWeekNumber(d) {
        const date = new Date(d);
        date.setHours(0,0,0,0);
        const thursday = new Date(date);
        thursday.setDate(date.getDate() + (4 - (date.getDay() || 7))); // move to thursday
        const year = thursday.getFullYear();
        const firstThursday = new Date(year, 0, 1);
        firstThursday.setDate(1 + (4 - (firstThursday.getDay() || 7)));
        const weekNum = Math.floor((thursday - firstThursday) / (86400000*7)) + 1;
        return { week: weekNum, year };
    }

    function getMonthYearKey(d) {
        const date = new Date(d);
        return `${date.getFullYear()}-${date.getMonth()}`;
    }

    // compute global timeline (weeks from earliest monday to latest sunday)
    function computeTimelineWeeks() {
        if (!tasks.length) return { weekList: [], monthSpans: [] };
        let minDate = null, maxDate = null;
        tasks.forEach(t => {
            if (t.start) { const sd = new Date(t.start); if (!minDate || sd < minDate) minDate = sd; }
            if (t.due) { const dd = new Date(t.due); if (!maxDate || dd > maxDate) maxDate = dd; }
        });
        if (!minDate || !maxDate) return { weekList: [], monthSpans: [] };
        // adjust to Monday of min week, Sunday of max week
        const startMonday = new Date(minDate);
        startMonday.setDate(minDate.getDate() - ((minDate.getDay() + 6) % 7)); // to monday
        const endSunday = new Date(maxDate);
        endSunday.setDate(maxDate.getDate() + (7 - (maxDate.getDay() || 7))); // next sunday

        const weekList = [];
        const current = new Date(startMonday);
        while (current <= endSunday) {
            const weekStart = new Date(current);
            const weekEnd = new Date(current); weekEnd.setDate(current.getDate() + 6);
            const { week } = getWeekNumber(current);
            weekList.push({ start: new Date(current), end: weekEnd, week });
            current.setDate(current.getDate() + 7);
        }

        // build month spans for header - each month gets own cell (separate th)
        const monthSpans = []; // array of { monthName, startIdx, endIdx, year, month }
        const monthMap = new Map(); 
        weekList.forEach((w, idx) => {
            const monthKey = getMonthYearKey(w.start);
            if (!monthMap.has(monthKey)) {
                const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
                const d = w.start;
                const monthIdx = d.getMonth();
                monthMap.set(monthKey, { 
                    name: `${monthNames[monthIdx]} ${d.getFullYear()}`,
                    startIdx: idx, endIdx: idx, year: d.getFullYear(), month: monthIdx,
                });
            } else {
                const obj = monthMap.get(monthKey);
                obj.endIdx = idx;
            }
        });
        // convert to array sorted by startIdx
        monthSpans.push(...Array.from(monthMap.values()).sort((a,b) => a.startIdx - b.startIdx));
        return { weekList, monthSpans };
    }

    // render table
    function render() {
        const { weekList, monthSpans } = computeTimelineWeeks();
        const header = document.getElementById('tableHeader');
        const body = document.getElementById('tableBody');
        
        // First header row: static columns + month cells (each month its own TH with colspan)
        let headerHtml = '<tr>';
        // static column headers (10 columns)
        headerHtml += '<th>Item</th><th>Task</th><th>Remark</th><th>SFDC</th><th>Assigned</th><th>Start</th><th>Due</th><th>Duration</th><th>Progress</th><th>Status</th>';
        // month cells
        for (let m of monthSpans) {
            const colspan = m.endIdx - m.startIdx + 1;
            const pastel = MONTH_PASTEL[(m.month + m.year) % 12];
            headerHtml += `<th colspan="${colspan}" class="month-header-cell" style="background:${pastel};">${m.name}</th>`;
        }
        headerHtml += '</tr>';

        // Second header row: week numbers (under static we leave empty, under months we put week numbers)
        headerHtml += '<tr>';
        // empty cells for static columns (10)
        for (let i=0; i<10; i++) headerHtml += '<th></th>';
        // week numbers, each in its own th with class week-cell
        for (let w of weekList) {
            headerHtml += `<th class="week-cell week-number-cell">W${w.week}</th>`;
        }
        headerHtml += '</tr>';
        header.innerHTML = headerHtml;

        // body rows
        let bodyHtml = '';
        tasks.forEach((task, index) => {
            const itemNum = index + 1;
            const start = task.start ? new Date(task.start) : null;
            const due = task.due ? new Date(task.due) : null;
            const duration = (start && due) ? Math.round((due - start) / (86400000)) + 'd' : '-';
            const statusColor = STATUS_COLOR[task.status] || '#94a3b8';

            bodyHtml += '<tr>';
            // item column with icons - 30% smaller applied via CSS
            bodyHtml += `<td><div class="item-icons"><span>${itemNum}</span><span class="edit-icon" data-id="${task.id}">‚úèÔ∏è</span><span class="delete-icon" data-id="${task.id}">üóëÔ∏è</span></div></td>`;
            // task (scrollable) double-click opens edit
            bodyHtml += `<td ondblclick="window.openEditModal('${task.id}')"><div class="scrollable-cell">${escapeHtml(task.task || '')}</div></td>`;
            // remark
            bodyHtml += `<td><div class="scrollable-cell">${escapeHtml(task.remark || '')}</div></td>`;
            // sfdc
            bodyHtml += `<td><div class="scrollable-cell">${escapeHtml(task.sfdc || '')}</div></td>`;
            // assigned
            bodyHtml += `<td><div class="scrollable-cell">${escapeHtml(task.assigned || '')}</div></td>`;
            // start
            bodyHtml += `<td>${task.start || ''}</td>`;
            // due
            bodyHtml += `<td>${task.due || ''}</td>`;
            // duration
            bodyHtml += `<td>${duration}</td>`;
            // progress bar (shorter bar)
            const p = task.progress || 0;
            bodyHtml += `<td><div class="progress-container"><div class="progress-bar-bg"><div class="progress-fill" style="width:${p}%;"></div></div><span class="progress-percent">${p}%</span></div></td>`;
            // status chip
            bodyHtml += `<td><span class="status-chip" style="background:${statusColor};">${task.status || 'Not Started'}</span></td>`;

            // Gantt week cells (use 29px width from week-cell class)
            for (let w of weekList) {
                let showCircle = false;
                if (start && due) {
                    const wStart = w.start, wEnd = w.end;
                    showCircle = (start <= wEnd && due >= wStart);
                }
                if (showCircle) {
                    bodyHtml += `<td class="week-cell"><span class="gantt-circle" style="background-color:${statusColor};"></span></td>`;
                } else {
                    bodyHtml += `<td class="week-cell"></td>`;
                }
            }
            bodyHtml += '</tr>';
        });
        body.innerHTML = bodyHtml;

        // attach event listeners to icons
        document.querySelectorAll('.edit-icon').forEach(el => {
            el.addEventListener('click', (e) => { e.stopPropagation(); openEditModal(el.dataset.id); });
        });
        document.querySelectorAll('.delete-icon').forEach(el => {
            el.addEventListener('click', (e) => { e.stopPropagation(); deleteTask(el.dataset.id); });
        });
    }

    window.escapeHtml = (text) => {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    };

    // modal handling
    const modalOverlay = document.getElementById('modalOverlay');
    const modalTitle = document.getElementById('modalTitle');
    const inpTask = document.getElementById('editTask');
    const inpSfdc = document.getElementById('editSfdc');
    const inpRemark = document.getElementById('editRemark');
    const inpAssigned = document.getElementById('editAssigned');
    const inpStart = document.getElementById('editStart');
    const inpDue = document.getElementById('editDue');
    const inpProgress = document.getElementById('editProgress');
    const inpStatus = document.getElementById('editStatus');
    let currentEditId = null;

    function openEditModal(id) {
        const task = tasks.find(t => t.id === id);
        if (task) {
            currentEditId = id;
            inpTask.value = task.task || '';
            inpSfdc.value = task.sfdc || '';
            inpRemark.value = task.remark || '';
            inpAssigned.value = task.assigned || '';
            inpStart.value = task.start || '';
            inpDue.value = task.due || '';
            inpProgress.value = task.progress || 0;
            inpStatus.value = task.status || 'Not Started';
            modalTitle.innerText = '‚úèÔ∏è Edit task';
        } else {
            currentEditId = null;
            inpTask.value = ''; inpSfdc.value = ''; inpRemark.value = ''; inpAssigned.value = '';
            inpStart.value = ''; inpDue.value = ''; inpProgress.value = 0; inpStatus.value = 'Not Started';
            modalTitle.innerText = '‚ûï New task';
        }
        modalOverlay.classList.remove('hidden');
    }
    window.openEditModal = openEditModal;

    function deleteTask(id) {
        if (confirm('Delete task?')) {
            tasks = tasks.filter(t => t.id !== id);
            saveTasks(); render();
        }
    }

    // save modal
    document.getElementById('modalSave').addEventListener('click', () => {
        const newTask = {
            id: currentEditId || (crypto.randomUUID ? crypto.randomUUID() : 'id-'+Date.now()+Math.random()),
            task: inpTask.value,
            sfdc: inpSfdc.value,
            remark: inpRemark.value,
            assigned: inpAssigned.value,
            start: inpStart.value,
            due: inpDue.value,
            progress: parseInt(inpProgress.value, 10) || 0,
            status: inpStatus.value,
        };
        if (currentEditId) {
            const idx = tasks.findIndex(t => t.id === currentEditId);
            if (idx >= 0) tasks[idx] = newTask;
        } else {
            tasks.push(newTask);
        }
        saveTasks(); render(); modalOverlay.classList.add('hidden');
    });
    document.getElementById('modalCancel').addEventListener('click', () => modalOverlay.classList.add('hidden'));
    document.getElementById('addTaskBtn').addEventListener('click', () => openEditModal(null));

    // import/export
    document.getElementById('importBtn').addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file'; input.accept = '.csv,.xlsx,.xls';
        input.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (loadEvent) => {
                const data = new Uint8Array(loadEvent.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                if (rows.length < 2) return;
                const newTasks = [];
                for (let i=1; i<rows.length; i++) {
                    const row = rows[i]; if (row.length < 2) continue;
                    const task = {
                        id: crypto.randomUUID?.(),
                        task: row[0] || '',
                        sfdc: row[1] || '',
                        remark: row[2] || '',
                        assigned: row[3] || '',
                        start: row[4] || '',
                        due: row[5] || '',
                        progress: parseInt(row[6]) || 0,
                        status: row[7] || 'Not Started',
                    };
                    if (task.task) newTasks.push(task);
                }
                if (newTasks.length) { tasks = newTasks; saveTasks(); render(); }
            };
            reader.readAsArrayBuffer(file);
        };
        input.click();
    });

    document.getElementById('exportExcelBtn').addEventListener('click', () => {
        const data = tasks.map(t => [t.task, t.sfdc, t.remark, t.assigned, t.start, t.due, t.progress, t.status]);
        data.unshift(['Task','SFDC','Remark','Assigned','Start','Due','Progress','Status']);
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);
        XLSX.utils.book_append_sheet(wb, ws, 'Tasks');
        XLSX.writeFile(wb, 'tasks_gantt.xlsx');
    });

    document.getElementById('exportPdfBtn').addEventListener('click', function() {
        const element = document.getElementById('ganttTable');
        html2canvas(element, { scale: 1.5, backgroundColor: '#ffffff' }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('l', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save('gantt.pdf');
        });
    });

    // initial load & render
    loadTasks(); render();
    // close modal if click outside
    modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) modalOverlay.classList.add('hidden'); });
})();
</script>
</body>
</html>
